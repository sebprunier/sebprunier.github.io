---
layout: post
title: Connecteurs Google+ pour Bonita Open Solution
date: 2011-10-03 09:54:39.000000000 +02:00
categories:
- Tutoriels
- Veille
tags:
- Bonita
- google+
- java
- json
status: publish
type: post
published: true
meta:
  _edit_last: '24226490'
  twitter_cards_summary_img_size: a:6:{i:0;i:434;i:1;i:138;i:2;i:3;i:3;s:24:"width="434"
    height="138"";s:4:"bits";i:8;s:4:"mime";s:9:"image/png";}
  _oembed_73365c9ba482ca3601df372699aca5ca: "{{unknown}}"
  _oembed_a9e34174b69a2358d3685b038111ae6f: "{{unknown}}"
  _oembed_2110b3ff5009e76f0e0955e22bf2d6c5: "{{unknown}}"
  _oembed_1ddf5c586354f611d0047f0093961951: "{{unknown}}"
  _oembed_6160be0eb54709ce4e50f0f99c550273: "{{unknown}}"
  _oembed_bedb98b22292c0a7a6d9a8f3e0e7e0be: "{{unknown}}"
  _oembed_06afef631e41cca748f722cea1e6c99e: "{{unknown}}"
  _oembed_2259dc6828d3805a08ee3eec32aece26: "{{unknown}}"
author: 
---
<p>Du 12 au 16 septembre 2011, j'ai suivi à Paris une formation organisée par BonitaSoft :</p>
<ul>
<li>Développement d'applications métier (3 jours)</li>
<li>Intégration avancée (2 jours)</li>
</ul>
<p>Lors de la partie "Développement de connecteurs personnalisés", je me suis dit "tiens, pourquoi je n'essaierais pas de développer des connecteurs pour Google+ ?" et surtout "tiens, c'est bizarre, ils n'existent pas encore dans les <a href="http://www.bonitasoft.org/exchange/" target="_blank">contributions</a>" ... Forcément puisque Google a sorti la version 1 de son API Google+ le ... 16 septembre ! Donc le dernier jour de ma formation :-)</p>
<p>A défaut d'avoir pu tester l'API G+ en formation, je l'ai fait un peu plus tard ! Voici donc mon humble contribution avec quelques explications de texte.</p>
<p>Pour ceux que ça intéresse :</p>
<ul>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetProfile.jar" target="_blank">GetUserProfile</a></li>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetActivities.jar" target="_blank">GetActivities</a></li>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetActivity.jar" target="_blank">GetActivity</a></li>
</ul>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/contribution.png"><img class="aligncenter size-medium wp-image-154" title="contribution" src="assets/contribution.png?w=300" alt="" width="300" height="95" /></a></p>
<p><!--more--></p>
<h2>Google+ API v1</h2>
<p>La version 1 de l'API Google+ est très très légère ... uniquement 3 fonctionnalités, uniquement pour de la récupération d'informations :</p>
<ul>
<li><a href="https://developers.google.com/+/api/latest/people/get" target="_blank">people/get</a> : récupère le profil d'une personne,</li>
<li><a href="https://developers.google.com/+/api/latest/activities/list" target="_blank">activities/list</a> : récupère les activités d'une personne donnée,</li>
<li><a href="https://developers.google.com/+/api/latest/activities/get" target="_blank">activities/get</a> : récupère le détail d'une activité.</li>
</ul>
<p>Donc pas de possibilité pour le moment de créer un connecteur publiant une info dans votre flux. Tant pis ! Contentons-nous pour le moment de ce qui existe.</p>
<p>Mon article se concentre sur le connecteur "GetActivities" et donc sur la méthode "activities/list" de l'API.</p>
<p>La requête HTTP GET à effectuer est la suivante :</p>
<pre>https://www.googleapis.com/plus/v1/people/{userId}/activities/{collection}<var></var></pre>
<p>Les paramètres obligatoires sont les suivants :</p>
<ul>
<li><strong>userId</strong> : l'identifiant de l'utilisateur. Par exemple : 101859091162395481354 (c'est <a href="http://gplus.to/sebprunier" target="_blank">moi</a> :-)) ou "me" pour faire référence à l'utilisateur authentifié.</li>
<li><strong>collection</strong> : la collection d'activités à lister. Pour le moment, seule la valeur "public" est supportée.</li>
</ul>
<p>Le connecteur gère d'autres paramètres optionnels :</p>
<ul>
<li><strong>maxResults</strong> : nombre maximum d'activités.</li>
<li><strong>fields</strong> : filtre pour récupérer une réponse partielle.</li>
</ul>
<p>Le connecteur ne gère pas à ce jour</p>
<ul>
<li>la pagination (paramètre "pageToken")</li>
<li>les alternatives pour le format de la réponse (paramètre "alt") car seul JSON est supporté à l'heure actuelle.</li>
</ul>
<h2>Exemple d'appel</h2>
<p>Un appel avec comme paramètres "maxResult = 3" et "fields = items/title" donnerait une réponse JSON du genre :</p>
<pre>{
 "items": [
  {
   "title": "..."
  },
  {
   "title": "..."
  },
  {
   "title": "..."
  }
 ]
}</pre>
<h2>Configuration du connecteur GetActivities</h2>
<p>Afin de tester le connecteur, imaginons un Processus très simple, sans grande utilité :-)</p>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/googleplus_connector_example_1-0.png"><img class="aligncenter size-medium wp-image-155" title="GooglePlus_Connector_Example_1.0" src="assets/googleplus_connector_example_1-0.png?w=300" alt="" width="300" height="79" /></a></p>
<p>La configuration du connecteur "GetActivities" se fait sur la première étape "get info". La seconde étape sert uniquement à afficher les résultats de l'appel.</p>
<p>Le processus possède 3 données :</p>
<ul>
<li>userId (String) : identifiant de l'utilisateur dont on veut lire les activités publiques  (renseigné dans l'IHM lors de la première étape du processus),</li>
<li>maxResults (Integer) : nombre maximum de résultats (renseigné dans l'IHM lors de la première étape du processus),</li>
<li>activities (java.util.List) : liste des activités (affichées lors de la deuxième étape du processus)</li>
</ul>
<p>Voici l'écran associé à la première étape du processus :</p>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/ecran-1.png"><img class="aligncenter size-medium wp-image-161" title="ecran-1" src="assets/ecran-1.png?w=300" alt="" width="300" height="153" /></a></p>
<p>La première chose à faire est de renseigner votre clé pour l'API Google+. Pour plus de détails : <a href="https://developers.google.com/+/api/oauth#apikey">https://developers.google.com/+/api/oauth#apikey</a> ou directement <a href="https://code.google.com/apis/console#access" target="_blank">https://code.google.com/apis/console#access</a></p>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/connector-config-apikey.png"><img class="aligncenter size-medium wp-image-156" title="connector-config-apikey" src="assets/connector-config-apikey.png?w=300" alt="" width="300" height="144" /></a></p>
<p>Ensuite vous pouvez renseigner les paramètres d'appel :</p>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/connector-config-userid.png"><img class="aligncenter size-medium wp-image-157" title="connector-config-userid" src="assets/connector-config-userid.png?w=300" alt="" width="300" height="170" /></a></p>
<h2>Traitement de la sortie du connecteur</h2>
<p>En sortie du connecteur, il faut manipuler les données de la réponse au format JSON. Cela est très simple et peut se faire facilement avec une expression Groovy grâce à la librairie <a href="http://json-lib.sourceforge.net/" target="_blank">JSON-lib</a> :</p>
<pre>def jsonObj = new JsonSlurper().parseText( response );
jsonObj.items.title;</pre>
<p>Ce petit morceau de code récupère les titres ("title") des entrées ("items") de la réponse JSON ("jsonObj").</p>
<p>Il est ensuite nécessaire d'affecter le résultat du script Groovy à la variable "activities". Ainsi la deuxième étape du processus pourra afficher correctement les résultats :</p>
<p><a href="http://sebprunier.files.wordpress.com/2011/09/ecran-2.png"><img class="aligncenter size-medium wp-image-162" title="ecran-2" src="assets/ecran-2.png?w=300" alt="" width="300" height="153" /></a></p>
<h2>Conclusion</h2>
<p>Lien vers le processus de la démo : <a href="http://www.filedropper.com/getuseractivities--10" target="_blank">http://www.filedropper.com/getuseractivities--10</a></p>
<p>Rappel des liens vers les connecteurs :</p>
<ul>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetProfile.jar" target="_blank">GetUserProfile</a></li>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetActivities.jar" target="_blank">GetActivities</a></li>
<li>Connecteur <a href="http://dl.dropbox.com/u/52447841/bonita/GetActivity.jar" target="_blank">GetActivity</a></li>
</ul>
